

*ssc inst _gwtmean

*Programme fait à partir de "Comparaison.do

if "`c(username)'" =="guillaumedaudin" {
	global dir_baseline_results "~/Documents/Recherche/2013 -- Trade Costs -- local/results/baseline"
	global dir_referee1 "~/Documents/Recherche/2013 -- Trade Costs -- local/results/referee1"
	global dir "~/Documents/Recherche/2013 -- Trade Costs -- local"
	global dir_comparaison "~/Documents/Recherche/2013 -- Trade Costs -- local/results/comparaisons_various"
	global dir_temp ~/Downloads/temp_stata
	global dir_results "~/Documents/Recherche/2013 -- Trade Costs -- local/results"
	global dir_git "~/Répertoires Git/trade_costs_git"
	
	
}


*** Juillet 2020: Lise, tout sur mon OneDrive


/* Fixe Lise P112*/
if "`c(hostname)'" =="LAB0271A" {
	 

	* baseline results sur hummels_tra dans son intégralité
    global dir_baseline_results "C:\Users\lpatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results\baseline"
	
		
	* résultats selon méthode référé 1
	global dir_referee1 "C:\Users\lpatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results\referee1"
	
	* stocker la comparaison des résultats
	global dir_comparaison "C:\Users\lpatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results\referee1\comparaison_baseline_referee1"
	
	/* Il me manque pour faire méthode 2 en IV 
	- IV_referee1_panel/results_estimTC_`year'_sitc2_3_`mode'.dta
	- IV_referee1_yearly/results_estimTC_`year'_sitc2_3_`mode'.dta
	
	*/
	
	global dir_temp "C:\Users\lpatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\temp"
	global dir "C:\Users\lpatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs"
	global dir_results "C:\Users\lpatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results"
	 
	 
	 
	}

/* Nouveau portable Lise */
if "`c(hostname)'" =="MSOP112C" {

	* baseline results sur hummels_tra dans son intégralité
    global dir_baseline_results "C:\Users\Ipatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results\baseline"
		
	* résultats selon méthode référé 1
	global dir_referee1 "C:\Users\Ipatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results\referee1"
	
	* stocker la comparaison des résultats
	global dir_comparaison "C:\Users\Ipatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results\referee1\comparaison_baseline_referee1"
	
	/* Il me manque pour faire méthode 2 en IV 
	- IV_referee1_panel/results_estimTC_`year'_sitc2_3_`mode'.dta
	- IV_referee1_yearly/results_estimTC_`year'_sitc2_3_`mode'.dta
	
	*/
	
	global dir_temp "C:\Users\Ipatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\temp"
	global dir "C:\Users\Ipatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs"
	global dir_results "C:\Users\Ipatureau\OneDrive - Université Paris-Dauphine\Université Paris-Dauphine\trade_costs\results"
	}



set more off

	
	


	
******************************************************
******************************************************
do "$dir_git/Open_year_mode_method_model.do"


******************Pour la table 4 du texte
collect clear

capture program drop table4_part
program table4_part
args method

global method `method'
if "$method"=="non_separé" local time_span 1974 (1) 2013
*if "$method"=="baseline" local time_span 1974 (1) 1978
if "$method"=="séparé_pour_robustesse_ns" local time_span 1974 (1) 2013

foreach mode in air ves {


	capture erase $dir_temp/data_${method}_`mode'.dta
	foreach year of num `time_span'  {
		open_year_mode_method_model `year' `mode' $method
		capture append using $dir_temp/data_${method}_`mode'.dta
		save $dir_temp/data_${method}_`mode'.dta, replace
	}
	
	
	use $dir_temp/data_${method}_`mode'.dta, replace
	egen value_year=total(val), by(year)
	generate weight = val/value_year
	
	
	generate N = 0
	generate Nb_sectors = 0
	generate Nb_partners = 0
	
	foreach year of num `time_span' {
		capture tabulate iso_o if year==`year'
		replace Nb_partners=r(r) if year==`year'
		capture tabulate sector if year==`year'
		replace Nb_sectors=r(r) if year==`year'
		egen N_`year'=count(prix_trsp), by(year)
		replace N=N_`year' if year==`year'
		drop N_`year'
		}
		
	
	collect, tags(model[data] var[N] mode[`mode'] digit[${method}]): /*
		*/ sum N [aweight=weight]
	collect, tags(model[data] var[Nb_sectors] mode[`mode'] digit[${method}]): /*
		*/ sum Nb_sectors [aweight=weight]
	collect, tags(model[data] var[Nb_partners] mode[`mode'] digit[${method}]): /*
		*/ sum Nb_partners[aweight=weight] 		

	replace terme_A=terme_A *100
	replace terme_I=(terme_I-1) *100
	
	collect, tags(model[nlAetI] var[terme_I] mode[`mode'] digit[${method}]) /*
		*/ : sum terme_I [aweight=weight], det
	collect, tags(model[nlAetI] var[terme_A] mode[`mode'] digit[${method}]) /*
		*/ : sum terme_A [aweight=weight], det
	collect, tags(model[nlAetI] var[beta] 	 mode[`mode'] digit[${method}]) /*
		*/ : sum beta [aweight=weight], det
	collect, tags(model[nlAetI] var[aic] 	 mode[`mode'] digit[${method}]) /*
		*/ : sum aic [aweight=weight], det
	
	
	save $dir_temp/data_`model'_${method}_`mode'.dta, replace
	
	
	
}


end


table4_part non_separé
table4_part séparé_pour_robustesse_ns



	
	
	collect layout (model[data]#result[mean]#var[N Nb_sectors Nb_partners] /*
		*/ model[nlAetI]#var[terme_I terme_A beta]#result[mean p50] var[aic]#result[mean]) /* 
		*/ (mode#digit[séparé_pour_robustesse_ns non_separé])
		
	
	collect label levels digit non_separé "wo separability"
	collect label levels digit séparé_pour_robustesse_ns "baseline"
	collect label levels var N "{$#$ obs.}"
	collect label levels var Nb_sectors "{$#$ sectors}"
	collect label levels var Nb_partners "{$#$ origin countries}"
	collect label levels result max "\textbf{Data}", modify
	collect label levels result mean "Mean", modify
	collect label levels result p50 "Median", modify
	collect label levels var terme_I "{\textit{Multiplicative term (in $%$)} ($\widehat{\tau}^{adv}$)}", modify
	collect label levels var terme_A "{\textit{Additive term (in $%$)} ($\widehat{t}/\widetilde{p}$)}", modify
	collect label levels var beta "$\widehat{\beta}$:  \textit{-Share of additive costs}", modify
	collect label levels model data "\textbf{Data}", modify
	collect label levels model nlAetI "{\textbf{Estimations}}"
	collect label levels var aic "{\textbf{AIC}}"
	
	collect style cell, warn nformat (%3.1f)
	collect style cell var[beta], warn nformat(%3.2f)
	collect style cell var[aic], warn nformat(%9.0fc)
	collect style cell var[N]#var[Nb_sectors]#var[Nb_partners], warn nformat(%9.0fc)
	collect style column, nodelimiter dups(center) position(top) width(asis)
	
	collect style save myappendixAB, replace
	
	
	collect preview
	
	collect export /* 		 
	*/ "$dir_git/redaction/JEGeo/revision_JEGeo/revised_article/Table4.tex", /*
	*/ tableonly replace
	
	




